@page "/trends"
@using System.Net.Http
@inject HttpClient Http

<div class="container is-max-desktop">
    <div class="field is-grouped" style="justify-content: center">
        <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg"
                 version="1.1"
                 width="24"
                 height="24"
                 viewBox="0 0 24 24">
                <g>
                    <rect fill="none" height="24" width="24" y="0" />
                </g>
                <g>
                    <path d="M19.48,12.35c-1.57-4.08-7.16-4.3-5.81-10.23c0.1-0.44-0.37-0.78-0.75-0.55C9.29,3.71,6.68,8,8.87,13.62 c0.18,0.46-0.36,0.89-0.75,0.59c-1.81-1.37-2-3.34-1.84-4.75c0.06-0.52-0.62-0.77-0.91-0.34C4.69,10.16,4,11.84,4,14.37 c0.38,5.6,5.11,7.32,6.81,7.54c2.43,0.31,5.06-0.14,6.95-1.87C19.84,18.11,20.6,15.03,19.48,12.35z M10.2,17.38 c1.44-0.35,2.18-1.39,2.38-2.31c0.33-1.43-0.96-2.83-0.09-5.09c0.33,1.87,3.27,3.04,3.27,5.08C15.84,17.59,13.1,19.76,10.2,17.38z"
                          fill="#fff" />
                </g>
            </svg>
        </span>
        <div class="title is-4 has-text-centered">
            <strong>&thinsp;Trends&emsp;&nbsp;</strong>
        </div>
    </div>
    <div class="box mb-5 py-3" style="background: linear-gradient(to top right, #323232, #4b4b4b)">
        <div class="columns is-gapless is-mobile">
            <div class="column has-text-centered">
                <p>(news section placeholder)</p>
                CoinGecko Top-7 Searched in last 24 hrs:
            </div>
        </div>
    </div>
</div>
<div class="container is-max-desktop">
    <div class="box mt-4 mb-2 py-0 is-transparent"
         style="border-color: #4b4b4b; border-radius: 5px; border-style: solid; border-width: 1px">
        <div class="columns is-gapless is-mobile">
            <div class="column">
                <strong>&nbsp;Logo</strong>
            </div>
            <div class="column has-text-centered">
                <strong>Name&emsp;</strong>
            </div>
            <div class="column has-text-right">
                <strong>Ticker</strong>
            </div>
        </div>
    </div>
    @try
    {
        @foreach (Coin c in @response.coins)
        {
            <div class="box mb-2" style="background: linear-gradient(to top right, #323232, #4b4b4b); padding: 5px;">
                <div class="columns is-gapless is-mobile is-vcentered pr-4">
                    <div class="column">
                        <img alt="@c.item.id logo" src="@c.item.large" style="height: 46px; width: 46px; vertical-align: middle" />
                        &emsp;# @(c.item.score + 1)
                    </div>
                    <div class="column has-text-centered">@c.item.name</div>
                    <div class="column has-text-right">@c.item.symbol</div>
                </div>
            </div>
        }
    }
    catch
    {
        <p>Loading...</p>
    }
</div>

@code {
    private string COINGECKO_TRENDS = "https://api.coingecko.com/api/v3/search/trending";
    public TrendResponse response;
    public class Item
    {
        public string id { get; set; }
        public string name { get; set; }
        public string symbol { get; set; }
        public int market_cap_rank { get; set; }
        public string thumb { get; set; }
        public string large { get; set; }
        public int score { get; set; }
    }

    public class Coin
    {
        public Item item { get; set; }
    }

    public class TrendResponse
    {
        public List<Coin> coins { get; set; }
        public List<object> exchanges { get; set; }
    }

    protected override async Task OnInitializedAsync()
    {
        response = await Http.GetFromJsonAsync<TrendResponse>(COINGECKO_TRENDS);
        Console.WriteLine(response.coins[0].item.name);
    }
}
